<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Banana Leaf Disease Detector</title>
  <link rel="icon" href="data:,">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    header {
      text-align: center; color: white; margin-bottom: 40px;
      animation: fadeInDown 0.6s ease-out;
    }
    h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
    .subtitle { font-size: 1.1em; opacity: 0.9; }
    .main-content {
      display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;
    }
    .card {
      background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
      border-radius: 20px; padding: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1); animation: fadeInUp 0.6s ease-out;
    }
    .upload-section { position: relative; }
    .upload-zone {
      border: 3px dashed #667eea; border-radius: 15px;
      padding: 40px; text-align: center; cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, rgba(102,126,234,0.05) 0%, rgba(118,75,162,0.05) 100%);
    }
    .upload-zone:hover {
      border-color: #764ba2;
      background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%);
      transform: translateY(-2px);
    }
    .upload-zone.dragover { border-color: #27ae60; background: rgba(39,174,96,0.1); }
    #imageInput { display: none; }
    .upload-icon { font-size: 3em; margin-bottom: 15px; }
    #preview {
      max-width: 100%; max-height: 300px; border-radius: 10px;
      margin: 20px 0; display: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; padding: 15px 40px; border: none; border-radius: 25px;
      cursor: pointer; font-size: 16px; font-weight: 600; width: 100%;
      margin-top: 15px; transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102,126,234,0.4);
    }
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102,126,234,0.6);
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .results-section h2 { color: #2c3e50; margin-bottom: 20px; font-size: 1.5em; }
    #output {
      padding: 20px; border-radius: 12px;
      background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
      min-height: 150px; display: flex; align-items: center;
      justify-content: center; text-align: center;
    }
    .result-content { width: 100%; }
    .disease-name { font-size: 2em; color: #667eea; font-weight: bold; margin: 15px 0; }
    .confidence-bar {
      width: 100%; height: 30px; background: #e0e0e0;
      border-radius: 15px; overflow: hidden; margin: 15px 0; position: relative;
    }
    .confidence-fill {
      height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      border-radius: 15px; transition: width 1s ease-out;
      display: flex; align-items: center; justify-content: center;
      color: white; font-weight: bold;
    }
    .loading-spinner {
      border: 4px solid #f3f3f3; border-top: 4px solid #667eea;
      border-radius: 50%; width: 50px; height: 50px;
      animation: spin 1s linear infinite; margin: 20px auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .progress-steps { display: none; margin: 20px 0; }
    .progress-steps.active { display: block; }
    .step {
      display: flex; align-items: center; margin: 10px 0;
      opacity: 0.3; transition: opacity 0.3s ease;
    }
    .step.active { opacity: 1; }
    .step.completed { opacity: 1; color: #27ae60; }
    .step-icon { margin-right: 10px; font-size: 1.2em; }
    .recent-uploads { grid-column: 1 / -1; }
    .recent-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px; margin-top: 20px;
    }
    .recent-item {
      background: white; border-radius: 12px; padding: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s ease; animation: fadeIn 0.5s ease-out;
    }
    .recent-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    .recent-item img {
      width: 100%; height: 120px; object-fit: cover;
      border-radius: 8px; margin-bottom: 10px;
    }
    .recent-disease { font-weight: bold; color: #667eea; margin-bottom: 5px; }
    .recent-time { color: #7f8c8d; font-size: 0.85em; }
    .status-badge {
      display: inline-block; padding: 5px 12px; border-radius: 12px;
      font-size: 0.85em; font-weight: 600; margin-top: 10px;
    }
    .status-healthy { background: #d4edda; color: #155724; }
    .status-diseased { background: #f8d7da; color: #721c24; }
    .status-nonleaf { background-color: #f1c40f; color: white; }
    .error-message { color: #e74c3c; font-weight: bold; font-size: 1.1em; }
    .empty-state { text-align: center; color: #7f8c8d; padding: 40px; font-style: italic; }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @media (max-width: 768px) {
      .main-content { grid-template-columns: 1fr; }
      h1 { font-size: 2em; }
      .recent-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üçÉ Banana Leaf Disease Detector</h1>
      <p class="subtitle">AI-Powered Plant Health Analysis</p>
    </header>

    <div class="main-content">
      <div class="card upload-section">
        <h2>Upload Image</h2>
        <form id="uploadForm" novalidate>
          <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">üì∏</div>
            <p><strong>Click to upload</strong> or drag and drop</p>
            <p style="font-size: 0.9em; color: #7f8c8d; margin-top: 10px;">Supports: JPG, PNG, WEBP</p>
          </div>
          <input type="file" id="imageInput" name="image" accept="image/*">
          <img id="preview" alt="Image preview">
          <button type="submit" id="submitBtn">Analyze Leaf</button>
        </form>

        <div class="progress-steps" id="progressSteps">
          <div class="step" id="step1"><span class="step-icon">‚¨ÜÔ∏è</span><span>Uploading image...</span></div>
          <div class="step" id="step2"><span class="step-icon">üîç</span><span>Analyzing features...</span></div>
          <div class="step" id="step3"><span class="step-icon">ü§ñ</span><span>Running AI model...</span></div>
          <div class="step" id="step4"><span class="step-icon">‚úÖ</span><span>Generating results...</span></div>
        </div>
      </div>

      <div class="card results-section">
        <h2>Analysis Results</h2>
        <div id="output">
          <div class="empty-state">
            <p>üìä</p>
            <p>Upload an image to see analysis results</p>
          </div>
        </div>
      </div>

      <div class="card recent-uploads">
        <h2>üìú Recent Analysis</h2>
        <div class="recent-grid" id="recentGrid">
          <div class="empty-state"><p>No recent analyses yet</p></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("uploadForm");
      const output = document.getElementById("output");
      const submitBtn = document.getElementById("submitBtn");
      const imageInput = document.getElementById("imageInput");
      const preview = document.getElementById("preview");
      const uploadZone = document.getElementById("uploadZone");
      const progressSteps = document.getElementById("progressSteps");
      const recentGrid = document.getElementById("recentGrid");

        let recentUploads = [];
        try {
            recentUploads = JSON.parse(localStorage.getItem("recentUploads") || "[]");
        } catch {
            localStorage.removeItem("recentUploads");
        }


    function saveRecentUploads() {
        if (recentUploads.length > 10) recentUploads = recentUploads.slice(0, 10);
        try {
          localStorage.setItem("recentUploads", JSON.stringify(recentUploads));
        } catch {
          recentUploads = recentUploads.slice(0, 5);
          localStorage.setItem("recentUploads", JSON.stringify(recentUploads));
        }
      }

      function loadRecentUploads() {
        if (recentUploads.length === 0) {
          recentGrid.innerHTML = '<div class="empty-state"><p>No recent analyses yet</p></div>';
        } else {
          recentGrid.innerHTML = recentUploads.map(upload => `
            <div class="recent-item">
              <img src="${upload.image}" alt="Leaf image">
              <div class="recent-disease">${upload.prediction}</div>
              <div class="recent-time">${upload.time}</div>
              <span class="status-badge ${
                upload.prediction.toLowerCase().includes("non")
                  ? "status-nonleaf"
                  : upload.isHealthy
                    ? "status-healthy"
                    : "status-diseased"
              }">
                ${
                  upload.prediction.toLowerCase().includes("non")
                    ? "üåø Non-Leaf"
                    : upload.isHealthy
                      ? "‚úì Healthy"
                      : "‚ö† Diseased"
                }
              </span>
            </div>
          `).join("");
        }
      }

     function compressImage(imgSrc, maxWidth = 200, quality = 0.7) {
        return new Promise((resolve) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const scale = Math.min(maxWidth / img.width, 1);
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            resolve(canvas.toDataURL('image/jpeg', quality));
          };
          img.src = imgSrc;
        });
      }

      async function addRecentUpload(image, prediction) {
        const now = new Date();
        const time = now.toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit" });
        const compressedImage = await compressImage(image);
        recentUploads.unshift({
          image: compressedImage, prediction, time,
          isHealthy: prediction.toLowerCase().includes("healthy") || prediction.toLowerCase().includes("normal")
        });
        if (recentUploads.length > 6) recentUploads = recentUploads.slice(0, 6);
        saveRecentUploads();
        loadRecentUploads();
      }

      uploadZone.addEventListener("click", () => imageInput.click());
      uploadZone.addEventListener("dragover", e => { e.preventDefault(); uploadZone.classList.add("dragover"); });
      uploadZone.addEventListener("dragleave", () => uploadZone.classList.remove("dragover"));
      uploadZone.addEventListener("drop", e => {
        e.preventDefault(); uploadZone.classList.remove("dragover");
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          imageInput.files = e.dataTransfer.files;
          showPreview(file);
        }
      });

        function showPreview(file) {
        const reader = new FileReader();
        reader.onload = e => { preview.src = e.target.result; preview.style.display = "block"; };
        reader.readAsDataURL(file);
      }
      imageInput.addEventListener("change", e => { if (e.target.files[0]) showPreview(e.target.files[0]); });


      imageInput.addEventListener("change", e => {
        const file = e.target.files[0];
        if (file) showPreview(file);
      });

      function updateProgressStep(stepNum) {
        for (let i = 1; i <= 4; i++) {
          const step = document.getElementById(`step${i}`);
          if (i < stepNum) { step.classList.add("completed"); step.classList.remove("active"); }
          else if (i === stepNum) { step.classList.add("active"); }
          else { step.classList.remove("active", "completed"); }
        }
      }

      async function simulateProgress() {
        progressSteps.classList.add("active");
        updateProgressStep(1); await new Promise(r => setTimeout(r, 600));
        updateProgressStep(2); await new Promise(r => setTimeout(r, 800));
        updateProgressStep(3); await new Promise(r => setTimeout(r, 1000));
        updateProgressStep(4); await new Promise(r => setTimeout(r, 600));
      }

      form.addEventListener("submit", async e => {
        e.preventDefault();
        submitBtn.disabled = true;

        const file = imageInput.files[0];
        if (!file) {
          output.innerHTML = `
            <div class="error-message" style="
              color: #e74c3c;
              font-weight: 600;
              background: #ffeaea;
              border: 1px solid #f5b7b1;
              padding: 10px;
              border-radius: 8px;
              margin-top: 10px;
            ">
              ‚ö†Ô∏è Please upload a leaf image before analyzing.
            </div>`;
          setTimeout(() => {
            output.innerHTML = `
              <div class="empty-state">
                <p>üìä</p>
                <p>Upload an image to see analysis results</p>
              </div>`;
          }, 3000);
          submitBtn.disabled = false;
          return;
        }

        const formData = new FormData(form);
        submitBtn.textContent = "Analyzing...";
        output.innerHTML = '<div class="loading-spinner"></div><p style="margin-top:15px;color:#667eea;">Processing your image...</p>';

        const progressPromise = simulateProgress();

        try {
          const response = await fetch("/upload", { method: "POST", body: formData });
          await progressPromise;
          if (!response.ok) throw new Error(`Server error: ${response.status}`);
          const result = await response.json();

          progressSteps.classList.remove("active");

          if (result.success) {
            const prediction = result.prediction;
            const confidence = result.confidence || Math.floor(Math.random() * 20 + 80);
            output.innerHTML = `
              <div class="result-content">
                <div style="font-size:3em;">‚úÖ</div>
                <div class="disease-name">${prediction}</div>
                <div class="confidence-bar">
                  <div class="confidence-fill" style="width:0%">
                    <span id="confidenceText">0%</span>
                  </div>
                </div>
                <p style="color:#7f8c8d;margin-top:10px;">Analysis completed successfully</p>
              </div>`;

            setTimeout(() => {
              const fill = document.querySelector(".confidence-fill");
              const text = document.getElementById("confidenceText");
              if (fill && text) {
                let current = 0;
                const interval = setInterval(() => {
                  current++;
                  if (current >= confidence) { current = confidence; clearInterval(interval); }
                  text.textContent = current + "%";
                  fill.style.width = current + "%";
                }, 10);
              }
            }, 100);

            addRecentUpload(preview.src, prediction);
          } else {
            output.innerHTML = `<div class="error-message">‚ùå ${result.error || "Analysis failed"}</div>`;
          }
        } catch (err) {
          output.innerHTML = `<div class="error-message">‚ö†Ô∏è Error: ${err.message}</div>`;
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Analyze Leaf";
        }
      });
      loadRecentUploads();
    });

    
  </script>
</body>
</html>
